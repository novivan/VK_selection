# VK_selection

## О голосованиях в Mattermost

Реализован бот для голосования, который поддерживает:
- Создание голосования
- Голосование за варианты
- Просмотр результатов
- Завершение голосования (создатель)
- Удаление голосования

### Требования
- Go
- Tarantool
- Mattermost сервер (для интеграции с ботом)

### Сборка и запуск

1. Соберите docker-окружение:
   - Установите Docker и Docker Compose.
   - Выполните команду:
     ```
     docker-compose up --build
     ```
2. Бот будет доступен на порту 8080.

### API эндпоинты
- POST /create: создание голосования
- POST /vote: голосование (в теле JSON: poll_id, option)
- GET /results?poll_id=...: получение результатов
- POST /finish: завершение голосования (в теле JSON: poll_id, creator)
- DELETE /delete?poll_id=...: удаление голосования
- POST /mattermost/command: эндпоинт для интеграции с Mattermost

### Настройка интеграции с Mattermost

1. **Убедитесь, что ваш бот доступен из сети**, где работает Mattermost. Если вы запускаете бот локально, настройте проксирование портов или используйте сервис типа ngrok:
   ```
   ngrok http 8080
   ```
   Запишите полученный URL (например, https://your-ngrok-url.ngrok.io).

2. **Настройте Slash-команды в Mattermost**:
   - Войдите в Mattermost как администратор
   - Перейдите в **Системная консоль** > **Интеграции** > **Slash-команды**
   - Нажмите "Добавить Slash-команду" со следующими параметрами:
     - **Заголовок**: Poll Bot
     - **Описание**: Бот для создания голосований
     - **Команда**: /poll
     - **URL запроса**: https://your-ngrok-url.ngrok.io/mattermost/command
     - **Метод запроса**: POST
     - **Токен**: _создайте и сохраните уникальный токен_
     - **Автозаполнение**: Включено

3. **Использование команд в Mattermost**:
   - `/poll create "Вопрос?" "Вариант1" "Вариант2" "Вариант3"` - создание голосования
   - `/poll vote [poll_id] [option]` - голосование за вариант
   - `/poll results [poll_id]` - просмотр результатов
   - `/poll finish [poll_id]` - завершение голосования (только создатель)
   - `/poll delete [poll_id]` - удаление голосования

4. **Примечание по безопасности**:
   - В реальном окружении рекомендуется настроить проверку токена от Mattermost
   - Используйте HTTPS для защищенного соединения

Если вы хотите расширенную интеграцию с оповещениями:

1. Настройте Incoming Webhook в Mattermost для отправки оповещений в определенный канал
2. Добавьте код отправки оповещений в ваш бот при создании голосований или публикации результатов